name: Deploy

on:
  push:
    branches: [ "main", "master" ]

jobs:
  build:

    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [20.x]
    steps:
    - uses: actions/checkout@v3
    - name: Use Node.js ${{ matrix.node-version }}
      uses: actions/setup-node@v3
      with:
        node-version: ${{ matrix.node-version }}
        cache: 'npm'
    - run: npm install
    - run: npm run build
    - name: Deploy to VPS
      uses: appleboy/ssh-action@master
      with:
        host: ${{ secrets.SSH_HOST }}
        username: root
        key: ${{ secrets.SSH_PASSWORD }}
        port: 22
        script: |
            rm -rf ~root/production/FE/dist
            mkdir -p ~root/production/FE/dist
            scp -r dist/* root@${{ secrets.SSH_HOST }}:~root/production/FE/dist
              
            cd production
            sudo docker compose down 
            sudo docker compose up -d
